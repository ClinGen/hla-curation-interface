{% extends "layouts/base.html" %}
{% block title %}Curation #{{ curation.pk }} Edit{% endblock %}
{% block description %}Edit information about curation #{{ curation.pk }}.{% endblock %}
{% block main %}
    <div class="box mt-6 mb-6">
        <nav class="breadcrumb" aria-label="breadcrumbs">
            <ul>
                <li>
                    <a href="{% url 'home' %}">
                        Home
                    </a>
                </li>
                <li>
                    <a href="{% url 'curation-search' %}">
                        Curations
                    </a>
                </li>
                <li>
                    <a href="{% url 'curation-detail' curation.pk %}">
                        Curation #{{ curation.pk }}
                    </a>
                </li>
                <li class="is-active">
                    <a href="" aria-current="page">
                        Edit Evidence
                    </a>
                </li>
            </ul>
        </nav>

        <h1 class="title">Curation Details</h1>
        <div class="block table-container">
            <table class="table">
                <tbody>
                {% if curation.curation_type == "ALL" %}
                    <tr>
                        <td>Allele</td>
                        <td id="allele">{{ curation.allele }}</td>
                    </tr>
                {% elif curation.curation_type == "HAP" %}
                    <tr>
                        <td>Haplotype</td>
                        <td id="haplotype">{{ curation.haplotype }}</td>
                    </tr>
                {% endif %}
                <tr>
                    <td>HCI Curation ID</td>
                    <td>{{ curation.pk }}</td>
                </tr>
                <tr>
                    <td>Added</td>
                    <td id="added-at">{{ curation.added_at|date:"Y-m-d" }}</td>
                </tr>
                </tbody>
            </table>
        </div>

        <div class="buttons">
            <a href="{% url 'curation-search' %}" class="button" id="search-button">
                {% include "common/icon.html" with icon_name="search" %}
                Search Curations
            </a>
            <a href="{% url 'curation-create' %}" class="button" id="add-button">
                {% include "common/icon.html" with icon_name="plus-circle" %}
                Add Another Curation
            </a>
        </div>
    </div>

    <div class="box mt-6 mb-6">
        <form method="post">{% csrf_token %}
            {{ evidence_formset.management_form }}
            <h1 class="title">Edit Evidence</h1>
            <div class="buttons">
                <button type="submit" class="button is-link" id="save-edit-button">
                    Save
                </button>
                <a href="{% url 'curation-detail' curation.pk %}" class="button is-link is-light" id="cancel-edit-button">
                    Cancel
                </a>
            </div>
            <div class="block table-container mt-4">
                <table class="table is-fullwidth">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Publication</th>
                            <th>Status</th>
                            <th>Conflicting</th>
                            <th>Included</th>
                            <th>Score</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for form in evidence_formset %}
                            {% for hidden in form.hidden_fields %}
                                {{ hidden }}
                            {% endfor %}
                            <tr>
                                <td>
                                    <a href="{% url 'evidence-detail' curation_pk=curation.pk evidence_pk=form.instance.pk %}">
                                        #{{ form.instance.pk }}
                                    </a>
                                </td>
                                <td>
                                    <a href="{% url 'publication-detail' form.instance.publication.pk %}">
                                        {{ form.instance.publication }}
                                    </a>
                                </td>
                                {% for field in form.visible_fields %}
                                    <td>
                                        {% if field.errors %}
                                            <div class="has-text-danger">{{ field.errors }}</div>
                                        {% endif %}
                                        <div class="field">
                                            <div class="control">
                                                {% if field.widget_type == "select" %}
                                                    <div class="select is-small">
                                                        {{ field }}
                                                    </div>
                                                {% else %}
                                                    {{ field }}
                                                {% endif %}
                                            </div>
                                        </div>
                                    </td>
                                {% endfor %}
                                <td>
                                    {{ form.instance.score }}
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </form>
    </div>
{% endblock %}
